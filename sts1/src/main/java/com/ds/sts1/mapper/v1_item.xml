<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="V1_Item">

	<!-- 물품관리 리스트 -->
	<select id="selectItem" resultType="com.ds.sts1.vo.V1_Item">
		SELECT
		ITM_NO, ITM_NAME,
		ITM_CONTENT,
		ITM_PRICE, ITM_QTY, ITM_IMG1, ITM_IMG2,
		ITM_IMG3, ITM_DATE
		FROM V1_ITEM ORDER BY ITM_NO ASC
	</select>


	<!-- <select id="selectItem" resultType="com.ds.sts1.vo.V1_Item"> select 
		* from ( SELECT * FROM ( SELECT rownum rnum,idx,title,content FROM page_table 
		) pagetable where rnum <= 20 ) where rnum >= 1; </select> -->


	<!-- 이미지 가져오기 -->

	<!-- 이 모델 클래스의 어떤 프로퍼티가 테이블의어떤 컬럼명이랑 매칭될 지를 정의해주면 됨 -->
	<!-- 기본컬럼은 id, 일반 컬럼은 result -->
	<resultMap type="com.ds.sts1.vo.V1_Item" id="maps">
		<result column="itm_img1" property="itm_img1" jdbcType="BLOB" />
		<result column="itm_img2" property="itm_img2" jdbcType="BLOB" />
		<result column="itm_img3" property="itm_img3" jdbcType="BLOB" />
	</resultMap>



	<!-- 사용자용 이미지 출력 -->
	<select id="selectImgAll" parameterType="int" resultMap="maps">
		SELECT
		NVL(ITM_IMG1, EMPTY_BLOB()) ITM_IMG1,
		NVL(ITM_IMG2, EMPTY_BLOB())
		ITM_IMG2,
		NVL(ITM_IMG3, EMPTY_BLOB()) ITM_IMG3
		FROM
		V1_ITEM
		WHERE
		ITM_NO=#{no}
	</select>

	
	<!-- 숫자 한개만 넘어오는 경우는 변수명은 상관없음 -->
	<select id="selectImgOne" parameterType="int" resultMap="maps">
		SELECT
		ITM_IMG1 FROM V1_ITEM WHERE ITM_NO=#{no}
	</select>

	<select id="selectImgTwo" parameterType="int" resultMap="maps">
		SELECT
		ITM_IMG2 FROM V1_ITEM WHERE ITM_NO=#{no}
	</select>

	<select id="selectImgThree" parameterType="int" resultMap="maps">
		SELECT ITM_IMG3 FROM V1_ITEM WHERE ITM_NO=#{no}
	</select>


	<!-- 물품추가하기 번호지정 -->
	<select id="selectItemNo" resultType="int">
		SELECT NVL(MAX(ITM_NO),0)
		FROM V1_ITEM
	</select>

	<!-- 물품추가 -->

	<insert id="insertItemOne"
		parameterType="com.ds.sts1.vo.V1_Item">
		INSERT INTO V1_ITEM VALUES(#{itm_no}, #{itm_name},
		#{itm_content}, #{itm_price},
		#{itm_qty}, #{itm_img1, jdbcType=BLOB},
		#{itm_img2, jdbcType=BLOB},
		#{itm_img3, jdbcType=BLOB}, SYSDATE)
	</insert>

	<!-- 물품삭제 -->
	<!-- foreach http://fruitdev.tistory.com/187 -->

	<delete id="deleteItem" parameterType="java.util.List">
		DELETE FROM V1_ITEM WHERE ITM_NO IN
		(

		<foreach collection="list" item="tmp" separator=",">
			#{tmp}
		</foreach>
		)
	</delete>

	<!-- 물품수정 -->
	<select id="selectEditItemOne" resultType="com.ds.sts1.vo.V1_Item"  parameterType="int"> 
		SELECT * FROM V1_ITEM WHERE ITM_NO=#{no} 
	</select>
	
	<!-- 물품수정후 -->
	<select id="updateItemOne" parameterType="com.ds.sts1.vo.V1_Item"> 
		UPDATE V1_ITEM SET ITM_NAME=#{itm_name}, ITM_CONTENT=#{itm_content}, 
		ITM_PRICE=#{itm_price}, ITM_QTY=#{itm_qty}
		<if test="itm_img1 != null">
			,ITM_IMG1=#{itm_img1, jdbcType=BLOB}
		</if>
		<if test="itm_img2 != null">
		,ITM_IMG2=#{itm_img2, jdbcType=BLOB}
		</if>
		<if test="itm_img3 != null">
		,ITM_IMG3=#{itm_img3, jdbcType=BLOB}
		</if>
		 WHERE ITM_NO=#{itm_no}
	</select>

	<!-- 물품한개삭제 -->
	<delete id="deleteOne" parameterType="int">
		DELETE FROM V1_ITEM
		WHERE ITM_NO=#{no}
	</delete>

</mapper>
